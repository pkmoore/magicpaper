\section{A Lesson Wrapped in an Illusion}
\label{SEC:background}


A magician creates an illusion to hide the secrets of his or her trick.
The lessons we have developed reverse this situation.
Instead of hiding secrets, we use our tricks to reveal
the mysteries behind
three cyberattacks.
This section details how the mechanics of each trick mirrors the
rationale behind the attacks by illustrating both the magician's and
participants' perspectives.

%We also include variations on each trick
%that can
%improve the
%trick's impact or make it easier to perform under certain circumstances.

\subsection{Lesson Layout}

For our lesson we decided to cover three topics: social engineering, side
channel attacks, and attacks on randomness.  We chose these topics because they
are highly relevant to the modern information security field,
and offer different levels of complexity.
Our hope was to illustrate how card magic can be used
successfully to teach anything from simple deceptive scenarios to complicated
technical attacks.  We chose the presentation order of our tricks to ease
students into the lesson before introducing more difficult concepts.

\subsection{Social Engineering}

In the context of information security, "social engineering" is defined as a set
of tactics designed to manipulate users into giving away personal information.
We start with this attack because it is broadly used and affects arguably the
greatest cross-section of victims.  The trick itself
is a simulation of the attack because it is engineered to give
the magician multiple opportunities to ask for personal information,
such as a participants full name or place of birth.  In this case,
it relies on the magic technique of misdirection,
with the novel situation presented by the trick
distracting the
volunteer participant from the magician's true intention: soliciting data that
can be used to compromise accounts, reset passwords using security questions, or
carry out identity theft.

At the end of the trick, the magician, who was the lead investigator of the
study, reveals that this information collection was the real purpose of the
trick.  Examples of real world social engineering attacks round out the
presentation.

\subsubsection{From the Audience's Perspective}

The magician begins this trick by requesting a student volunteer and stating
that there is a way to form a psychic bond between the student and a deck of
cards.  The student shuffles
half of the cards a few times while the magician shuffles the other half.  Once
this shuffling is complete, the two halves of the deck are placed
one on top of the other.
The magician asks the student
a few questions to further ``attune'' them to the deck,
starting with their birth year.
The response
is used to select one red card and one black card from the deck,
each with a numeric value equal to one of the last two digits of
the volunteer's birth year.
Next, the magician asks for the student's birth month and similarly selects
a red card with a numeric value equal
to their birth month (using the jack and queen for November and December
respectively).
Finally, the magician asks the student
for their birthday and selects a black card with a numeric value
equal to the second digit in this day.
The magician lays these cards out on the table and asks the student to select
one red card and one black card with which they feel most ``attuned''.
The unchosen cards are returned to the middle
of the deck face up.

At this point, the magician declares
that it is time to test the student's psychic powers by asking them to
guess the color of each card in the deck.  Starting with the top of the deck,
the student provides a guess of either ``red'' or ``black,''  while the magician
records the guess by placing the card face down on top of the card of the same
color already on the table.  This forms two piles of cards.  When the half-way
point of the deck is reached, the two face up cards are placed on top of the
pile of the opposite color,
switching which pile each guess
will be placed in going forward.  The student continues providing guesses until
there are no cards remaining.  At this point the magician turns over the face
down cards to reveal that the student has correctly guessed {\textbf every}
card's color, building the illusion that a psychic connection has been made.

With the volunteer ``hooked,'' the magician keeps pumping for information by
suggesting the deck can read minds.
To demonstrate this,
the deck was put back together and the volunteer was asked to re-shuffle them
a few times and cut the deck into two piles.
The magician
selects one of the piles and, without looking at it,
reveals the bottom card to the student and the
audience.
This pile is placed on top of the other pile perpendicularly so that
the students card remains accessible.  The magician then asks the student to
make a series of statement pairs with one being true and one being false.  For
example,  the magician may ask the student to state  ``I was born in
\textit{blank},'' with blank being replaced by their birth city, and ``I was
born in Moscow, Russia,'' (assuming the student was \textit{not} born in Moscow,
Russia).  A similar process is used to have the student make true/false
statement pairs about where they attended school earlier in their life, the name
of their childhood best friend, and other similar details about their life.

After the magician has elicited a number of statements sufficient to hone in on
the student's psychic link, a second set of true/false statement pairs are used
to figure out the student's card.  This is done by asking the student to make
statements pairs like ``My card is red'' and ``My card is black.''  Similar
pairs regarding the card's suit and value allow the magician to zero
in on the student's card.

At this point, the trick takes a turn when the magician presents a spreadsheet
to the student and the audience containing their responses to the questions
asked in the course of the trick. This reveals that the trick
was a deception to
collect personal information, generating an opportunity for discussion about what
types of information should can be used in identity theft attempts should they
be made public.


\subsubsection{Behind the Scenes}
\begin{figure}[H]
\centering
\includegraphics[scale=.6]{images/Trick1}
\caption{Arrangement of cards after participant has guessed the color of each
card in the deck.  The ``correct column'' contains red card in a red pile and
black cards in a black pile.  The ``incorrect column'' contains the reverse.
Correct cards are revealed by flipping each pile in place.  Incorrect cards are
made to appear correct by using the discussed flipping technique.
\label{fig:trick1}
\end{figure}

This trick begins with a deck where the cards have
been separated into red and black halves.
The magician must make note of where in the deck
one color ends and the other begins.  The initial ``attunement'' process where
the student shuffles half the cards is done by splitting the deck at this point
and giving the student all of either the red cards or black cards.  This means
that the student and magician's initial shuffling efforts are merely scrambling
cards of the same color.
When the two packs are stacked one on top of the other the two colors remain
separate.

In the first question and answer portion of the trick the magician is able to
pull out two red and two black cards that reflect the student's answer.  The
student then picks two of these cards to remain out while the other two are
returned to the deck.  At this point, the magician must return these cards face
up exactly between the red and black ``sections'' of the deck.  This is used in
the next phase of the trick to signal the magician when all of one color of card
has been dealt into one of the two piles.

During the prediction phase of the trick, the student believes that they are
guessing the color of cards from a mixture of red and black.  In reality, this
phase of the trick happens in two phases.
For the purposes of this description,
assume that the top of the deck
contains all of the black cards.
This means that some of the students
guess are correct.
When the midway point is reached the magician takes the two face up cards and places the
red one face up on the black pile and vice versa.  This switches which pile will
receive each color for the remainder of the guessing phase.  The midway point
also signals to the magician that the black cards have been
exhausted leaving only red cards.

After all card have been guessed, there will be two piles,
one containing all correct guesses and the other
all incorrect guesses.
An illustration of this arrangement appears in Figure~\ref{fig:trickl1}.
The reveal proceeds as follows.
First the magician shows that the student correctly guessed all of the cards
in the correct pile.  This should be done showing one color at a time for
dramatic effect.  When revealing the other pile the magician must collect the
entire pile and flip it towards themselves rather than to the side.  This
reverses the incorrect guesses so that the red cards are now paired
with the red marker card and the black with the black marker.  This completes
the illusion that the student correctly guessed {\textbf every} card in the
deck.

The second trick in this lesson trivially follows the performance of this trick.
To set it up the magician combines the cards of the two piles and asks the
student to shuffle them.  During this process, the magician must pay close
attention to which card appears on the bottom of the deck.  This is possible
because many novices reveal the faces of a deck of cards when shuffling.  Next,
the magician asks the student to cut the deck into two packs.  The pack that
formed the bottom of the deck pre-cut is chosen to be placed perpendicularly on
top of the other, ensuring that the student's card was the bottom card of
the deck pre-cut.  It is trivial to see how the magician knows the student's
card at this point.  However, instead of simply revealing this information the
magician uses the statement pairs component of the trick to ``pump'' the student
for more information in order to reinforce the social engineering aspect of the
lesson.

%\subsubsection{Variations}
%
%...

\subsubsection{The Lesson}

This trick is intended to spark a teachable moment about social engineering and
its dangers.  The most powerful point comes with the reveal that the magician's
intended goal was to steal personal information.
Building upon this reveal allows instructors to start a dialogue with
students about what other
sorts of information an attacker might try to steal and the purposes for which
they might use it.
The next step is to introduce a more formal definition of social engineering as
a malicious attempt to steal personal information.
This discussion covers the aspects of human nature that allow social engineering
attacks to succeed.  We show how these features may be employed through two real world examples -- extended
warranty scams and phishing campaigns.
At the end of this discussion we hope to leave students with a sense of the
dangers of social engineering and a tool-set with which they can protect
themselves and others.

\subsection{Side Channel Attacks}

As the name implies, a side channel; attack is one that strikes indirectly
by tracking seemingly unrelated phenomena
such as timing information, power consumption, electromagnetic leaks, or even
sounds.  To mirror this type of attack, the trick
demonstrates how an attacker can
gather information without directly exploiting
a vulnerability in a system or algorithm.
The main version of this trick enlists a ``side channel'' to
enable the magician to easily
find a particular card that has been lost in a shuffled deck.

\subsubsection{From the Audience's Perspective}

The magician begins by opening a new deck of cards, removing the jokers and
branding cards, and legitimately shuffling it.  A student is asked to
select a card from the deck, show it to the audience, memorize it without
revealing it to the magician, and then return it to the deck.
The magician shuffles the deck a few more times ensuring that the card has
been completely lost.
Lastly, the magician proceeds through the deck face down and picks out the
student's card when it appears.

This trick's reveal comes when the magician informs the audience
the card was found using a secret information side channel present in the
deck and asks if they have any idea of what it might be.
At this point, the audience is either stumped or has figured out how the trick
worked.  In either case,  the second phase of the lesson
introduces additional types of side channels
by having a pre-selected volunteer (or a teaching assistant)
surreptitiously
communicate the details of a card
to the magician.
The volunteer selects a card and asks the magician questions about its
attributes.
For example, ``Is my card red or black?''
When asking these questions the volunteer communicates the true nature of
what they are conveying
by varying the pitch of their voice, vocal cadence, or body language.
After sufficient questioning, the magician is able to determine which card the
volunteer picked and asks the audience if they were able to determine the side
channel used to communicate this information.

\subsubsection{Behind the Scenes}

\begin{figure}[H]
\centering
\includegraphics[scale=.8]{images/Trick2}
\caption{Flawed card backs allow the magician to see when a card is
``upside-down'' in the deck.  The magician takes advantage of this by
  turning cards upside-down when returning
  them to the deck after the participants have memorized them.}
\label{fig:trick2}
\end{figure}

The key to this trick lies in the magician's choice of deck.  Many cheaper card
decks, such as those given away as branded merchandise,
have corporate logos or
text as part of the art on the card back.  Often, this branding can be used to
provide information about how a card is oriented in the deck.  Because the trick
begins with a fresh deck, all cards are oriented in the same direction.  As a
result, when the student is returning their card to the deck, the magician
simply has to orient the deck in such a way that the student's card is returned
in the opposite orientation to the other cards.  During all shuffling
operations, the magician may maintain this orientation by rotating one pack of a
cut deck so that it's post-shuffle orientation matches the other pack.
To complete the trick, the magician only has to look through the deck of cards
and find the card with a differing orientation.  Figure~\ref{fig:trick2}
illustrates the magician's view of the deck of cards before the trick's
reveal.

%\subsubsection{Variations}
%
%...

\subsubsection{The Lesson}

The purpose of this lesson is to encourage students to think about the
non-obvious avenues an attacker might use to acquire secret information from a
system.  A powerful example of such a channel is provided by the tricks reveal
that the information contained by a card can extend beyond its face value to
subtle details of the graphics on its back and even its orientation.  This
reveal
presents an opportunity to discuss side channels in more detail.
In our lesson, we discuss side channels as
a security weakness that allows information to be extracted via attributes
of a system, rather than a flaw in an
algorithm.
We cover how, in the real world,
potential side channels can include
physical phenomena,
such as
temperature,
sound,
and even electromagnetic output.
In order to emphasize the impact of such attacks we cover two examples: Van
Eck Phreaking and the SPECTRE vulnerabilities.
The former is a technique where images displayed by a computer monitor can be
detected and reconstructed using off-the-shelf radio hardware.
The latter is a major vulnerability recently discovered in most major types of
processors that uses timing information to extract sensitive data from a
computer's memory.
The lesson concludes with tips on how to
reduce the risk of a side channel attack
by minimizing the number of potential channels,
and actively working to decouple potential
side channels from secret information.

\subsection{Attacks on Randomness}


True randomness is important in many
security-sensitive situations.
An attacker who is able to predict or influence the output of a random number
generator may use this capability to circumvent cryptographic security controls.
The trick we use to cover this concept
illustrates a potential vulnerability in cryptographic hash functions
-- that the last input to the function has a high degree of control over
the function's output.


\subsubsection{From the Audience's Perspective}

The trick begins with the magician announcing that they are going to
use their experience with card magic to guess the value of card that
has been randomly selected from the deck.  They expand by explaining that every
card has different amounts of ink on its face which gives each one a unique
weight that a trained magician can detect by feel.
The trick starts with the magician spreading a deck of cards on the table
in front of the
audience in order to prove its authenticity.
The magician then shuffles the deck of cards and deals five cards out onto the
table.  It is from these five cards that the magician will make their
prediction.
In order to head off suspicion that the magician has engineered the trick to
pick a specific card that they know they it is revealed that
they will use a software random number generator to
select the card so that there can be no sleight of hand to select a
pre-determined card.
Students are asked to shout out numbers to be fed into the random number
generator to seed its operation.  After many numbers have been input, the
magician generates a number between 1 and 5 with each value referring to a
specific card.  The magician moves the chosen card forward and slides it back
and forth on the table to get an idea of its weight.  The magician then makes
their prediction and reveals that it is correct!

\subsubsection{Behind the Scenes}

\begin{figure}[H]
\centering
\includegraphics[scale=.6]{images/Trick3}
\caption{Participant inputs are repeatedly fed into our ``random number
generator'' in order to seed its output.  The magician stops entering inputs
when hidden display indicates memorized card would be chosen.}
\label{fig:trick3}
\end{figure}

This trick relies on two components for its successful operation.
The first comes at the beginning of the trick when the deck is spread out on the
table before the students.  This movement serves the dual purpose of convincing
the students that the deck is genuine and gives the magician a chance to
memorize one or more of the top five cards in the deck.  When the deck is
shuffled, the magician is careful to not allow the cards that were memorized to
become mixed in with the rest of the deck.  This allows them to ensure that it
is these cards that are dealt down onto the table prior to making a prediction.


The second key lies in how the random number is generated.
Rather than
a true software random number generator, the magician's tool is based on a hash
function.  This means that, while output appears random, it is anything but.
As student's shouted numbers are fed into the tool the magician monitors an
intermediate output.
This output shows the result of first feeding the students number
into the hash function, then using modulus to reduce the output to a value
between zero and four, and finally adding one in order to get a value between
one and five.
The magician can use this input to determine when the output will be a number
corresponding with a card they have memorized and stop supplying inputs.
Figure~\ref{fig:trick3} illustrates how these two pieces interact to make
the trick work.


%\subsubsection{Variations}
%
%...

\subsubsection{The Lesson}

The purpose of this lesson is to show students the importance of correct
randomness
that is "fit for purpose," or appropriate for security-sensitive applications.
It also shows how an attacker
with a small amount of influence,
such as when to stop supplying numbers,
can compromise a
system.
As such, we begin by covering the common pitfalls
that occur when generating and
using randomness.
This foundation is used to explain both
direct and input-based attacks on random
number generators.
The explanation of these attacks gives our students the background they need to
understand how why the magician's random number generator was invalid as well as
many of the most important properties of cryptographic hash functions.

%The trick we use reinforces this using
%a situation where ``users'' are able to provide input
%directly to a cryptographic hash function.
%We build on this by discussing how these functions work and their importance
%in applications like cryptocurrency and password storage.
